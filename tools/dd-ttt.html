<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit">
    <title>滴滴出行行程报销单</title>

    <link rel="stylesheet" href="//cdn.jsdelivr.net/bootstrap/3.3.7/css/bootstrap.min.css">

    <style>
        th {
            background-color: #666666;
            color: white;
            text-align: center;
            vertical-align: middle !important;
            font-size: 18px;
        }

        td {
            text-align: center;
            color: #747474;
            font-size: 16px;
        }

        tr.active {
            color: #f0f0f0
        }

        body {
            font-size: 18px;
        }
    </style>

    <script src="//cdn.jsdelivr.net/g/jquery@3.2.1,bootstrap@3.3.7,vue@2.3.2"></script>
</head>
<body>
<div class="container-fluid" id="app" v-cloak>
    <div class="row">
        <div class="col-xs-12">
            <form class="form-inline">
                <div class="form-group">
                    <label for="applicationDate">申请日期</label>
                    <input type="date" class="form-control" id="applicationDate" v-model.trim="applicationDate">
                </div>
                <div class="form-group">
                    <label for="mobileNumber">行程人手机号</label>
                    <input type="text" class="form-control" id="mobileNumber" v-model.trim="mobileNumber" size="11">
                </div>
                <div class="form-group">
                    <label for="autoType">车型</label>
                    <input type="text" class="form-control" id="autoType" v-model.trim="autoType" size="2">
                </div>
                <div class="form-group">
                    <label for="city">城市</label>
                    <input type="text" class="form-control" id="city" v-model.trim="city" size="2">
                </div>
            </form>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12">
            <form class="form-inline">
                <div class="form-group">
                    <label for="startTime">上车时间</label>
                    <input type="datetime-local" class="form-control" id="startTime" size="10">
                </div>
                <div class="form-group">
                    <label for="startPoint">起点</label>
                    <input type="text" class="form-control" id="startPoint" size="4">
                </div>
                <div class="form-group">
                    <label for="endPoint">终点</label>
                    <input type="text" class="form-control" id="endPoint" size="4">
                </div>
                <div class="form-group">
                    <label for="mileage">里程</label>
                    <input type="number" class="form-control" id="mileage" size="4">
                </div>
                <div class="form-group">
                    <label for="money">金额</label>
                    <input type="number" class="form-control" id="money" size="4">
                </div>
                <button type="button" class="btn btn-default" @click="addTravel">增加</button>
            </form>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12">
            <hr>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-4">█ 申请日期:{{ applicationDate }}</div>
        <div class="col-xs-8">█ 行程时间:{{ startDay }} 至 {{ endDay }}</div>
    </div>
    <div class="row">
        <div class="col-xs-4">█ 行程人手机号:{{ mobileNumber }}</div>
        <div class="col-xs-8">█ 共{{ travels.length }}笔行程，合计{{ amount | number(2) }}元</div>
    </div>
    <div class="row">
        <div class="col-xs-12">
            <table class="table">
                <thead>
                <tr>
                    <th>序号</th>
                    <th>车型</th>
                    <th>上车时间</th>
                    <th>城 市</th>
                    <th>起点</th>
                    <th>终点</th>
                    <th>里程<br>[公里]</th>
                    <th>金额<br>[元]</th>
                    <th>备注</th>
                </tr>
                </thead>
                <tbody>
                <template v-for="(item, index) in travels">
                    <tr v-bind:class="{active:index % 2 == 1}"
                        v-on:mouseenter="$('#btnClose' + index).removeClass('hidden')"
                        v-on:mouseleave="$('#btnClose' + index).addClass('hidden')">
                        <td>{{ index + 1 }}</td>
                        <td>{{ autoType }}</td>
                        <td>{{ item.startTime | dateAndTime }}</td>
                        <td>{{ city }}</td>
                        <td>{{ item.startPoint }}</td>
                        <td>{{ item.endPoint }}</td>
                        <td>{{ item.mileage | number(1) }}</td>
                        <td>{{ item.money | number(2) }}</td>
                        <td>
                            <button :id="'btnClose' + index" type="button" class="close hidden" aria-label="Close"
                                    v-on:click="travels.splice(index, 1)"><span
                                aria-hidden="true">&times;</span></button>
                        </td>
                    </tr>
                </template>
                </tbody>
            </table>
        </div>
    </div>
</div>
</body>
<script>
    function formatNumber(value) {
        return value < 10 ? "0" + value : value;
    }

    function formatDate(value) {
        var date = new Date(value);
        if (value) {
            return [
                formatNumber(date.getFullYear()),
                formatNumber(date.getMonth() + 1),
                formatNumber(date.getDate())
            ].join("-");
        }
        return "";
    }

    var vm = new Vue({
        "el": "#app",
        "data": {
            "applicationDate": formatDate(new Date()),
            "mobileNumber": "18058775981",
            "autoType": "快车",
            "city": "杭州",
            "travels": []
        },
        "computed": {
            "amount": function () {
                var result = 0;
                this.travels.forEach(function (element) {
                    var money = Number(element.money);
                    if (money !== NaN) {
                        result += money;
                    }
                });
                return result;
            },
            "startDay": function () {
                var length = this.travels.length;
                if (length > 0) {
                    return formatDate(this.travels[0].startTime);
                }
                return "";
            },
            "endDay": function () {
                var length = this.travels.length;
                if (length > 0) {
                    return formatDate(this.travels[length - 1].startTime);
                }
                return "";
            }
        },
        "filters": {
            "dateAndTime": function (value) {
                var date = new Date(value);
                if (date) {
                    var month = date.getMonth();
                    var dayOfMonth = date.getDate();
                    var dayOfWeek = date.getDay();
                    return [
                        formatNumber((month + 1)) + "-" + formatNumber(dayOfMonth),
                        formatNumber(date.getHours()) + ":" + formatNumber(date.getMinutes()),
                        ["周日", "周一", "周二", "周三", "周四", "周五", "周六"][dayOfWeek]
                    ].join(" ");
                }
                return NaN;
            },
            "number": function (value, number) {
                return Number(value).toFixed(number)
            }
        },
        "methods": {
            "addTravel": function () {
                var item = {
                    "startTime": $("#startTime").val(),
                    "startPoint": $("#startPoint").val(),
                    "endPoint": $("#endPoint").val(),
                    "mileage": $("#mileage").val(),
                    "money": $("#money").val()
                };
                this.travels.push(item);
                this.travels.sort(function (a, b) {
                    return a.startTime > b.startTime;
                });
            }
        }
    });
</script>
</html>
